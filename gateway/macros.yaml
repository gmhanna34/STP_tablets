# =============================================================================
# STP Macro & Button Configuration
# =============================================================================
# This file defines:
#   1. macros   — Named sequences of steps (the logic)
#   2. buttons  — Page-specific button layouts (the UI)
#
# STEP TYPES:
#   ha_check      Check a Home Assistant entity state
#   ha_service    Call a Home Assistant service
#   moip_switch   Switch a single video TX → RX
#   moip_ir       Send an IR code via MoIP receiver
#   moip_scene    Execute a pre-defined MoIP scene (DEPRECATED — use moip_switch)
#   epson_power   Control a single projector (on/off)
#   epson_all     Control all projectors (on/off)
#   x32_scene     Load an X32 mixer scene
#   x32_mute      Mute/unmute an X32 channel
#   obs_emit      Trigger an OBS action (StartStream, StopStream, etc.)
#   ptz_preset    Recall a PTZ camera preset
#   delay         Wait N seconds (with optional progress message)
#   macro         Call another macro (nesting, max depth 5)
#   condition     If/then/else branching based on a check
#   notify        Broadcast a message to all tablets
#
# ON_FAIL OPTIONS (per step):
#   abort         Stop the macro and report failure (default)
#   skip          Log a warning, continue to the next step
#   retry:N       Retry the step N times (1s between attempts)
# =============================================================================


macros:

  # ---------------------------------------------------------------------------
  # CHAPEL
  # ---------------------------------------------------------------------------

  chapel_tv_on:
    label: "Chapel TVs On"
    icon: "tv"
    description: "Check battery power, send IR power-on, set HDMI input"
    steps:
      - type: ha_check
        entity: "switch.bat_chapeltv_1_ac_enabled"
        expect: "on"
        on_fail: abort
        message: "Chapel TV 1 EcoFlow AC power is off — charge battery first"

      - type: ha_check
        entity: "switch.bat_chapeltv_2_ac_enabled"
        expect: "on"
        on_fail: skip
        message: "Chapel TV 2 EcoFlow AC power is off (non-critical)"

      - type: moip_ir
        receiver: 5
        code: "IRPowerOn"
        message: "Sending power-on to Chapel TV 1"

      - type: moip_ir
        receiver: 6
        code: "IRPowerOn"
        message: "Sending power-on to Chapel TV 2"

      - type: delay
        seconds: 5
        message: "Waiting for TVs to initialize"

      - type: moip_ir
        receiver: 5
        code: "IRSourceHDMI1"
        message: "Setting Chapel TV 1 to HDMI 1"

      - type: moip_ir
        receiver: 6
        code: "IRSourceHDMI1"
        message: "Setting Chapel TV 2 to HDMI 1"

  chapel_tv_off:
    label: "Chapel TVs Off"
    icon: "tv_off"
    confirm: "Turn off all Chapel TVs?"
    steps:
      - type: moip_ir
        receiver: 5
        code: "IRPowerOff"
        message: "Powering off Chapel TV 1"

      - type: moip_ir
        receiver: 6
        code: "IRPowerOff"
        message: "Powering off Chapel TV 2"

      - type: notify
        message: "Chapel TVs powered off"

  chapel_audio_on:
    label: "Chapel Audio On"
    icon: "mic"
    description: "Turn on chapel audio via Home Assistant"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.chapel_audio_power" }
        on_fail: abort
        message: "Failed to turn on chapel audio power"

  chapel_audio_off:
    label: "Chapel Audio Off"
    icon: "mic_off"
    confirm: "Turn off Chapel audio?"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.chapel_audio_power" }

  chapel_ac_on:
    label: "Chapel A/C On"
    icon: "thermostat"
    steps:
      - type: ha_service
        domain: "climate"
        service: "turn_on"
        data: { entity_id: "climate.chapel_and_main_hallway" }

  chapel_ac_off:
    label: "Chapel A/C Off"
    icon: "thermostat"
    confirm: "Turn off Chapel A/C?"
    steps:
      - type: ha_service
        domain: "climate"
        service: "turn_off"
        data: { entity_id: "climate.chapel_and_main_hallway" }

  chapel_source_appletv:
    label: "Chapel Apple TV"
    icon: "cast"
    steps:
      - type: moip_switch
        tx: 14
        rx: 5
      - type: moip_switch
        tx: 14
        rx: 6

  chapel_source_livestream:
    label: "Chapel Live Stream"
    icon: "live_tv"
    steps:
      - type: moip_switch
        tx: 8
        rx: 5
      - type: moip_switch
        tx: 8
        rx: 6

  chapel_source_logo:
    label: "Chapel LOGO"
    icon: "image"
    steps:
      - type: moip_switch
        tx: 16
        rx: 5
      - type: moip_switch
        tx: 16
        rx: 6

  chapel_source_announcements:
    label: "Chapel Announcements"
    icon: "announcement"
    steps:
      - type: moip_switch
        tx: 9
        rx: 5
      - type: moip_switch
        tx: 9
        rx: 6

  # --- Nested macro: full chapel setup ---
  chapel_full_setup:
    label: "Chapel Full Setup"
    icon: "play_circle"
    confirm: "Run full Chapel AV setup (TVs, audio, A/C)?"
    steps:
      - type: macro
        macro: "chapel_tv_on"
        message: "Setting up Chapel TVs"
      - type: macro
        macro: "chapel_audio_on"
        message: "Setting up Chapel audio"
      - type: macro
        macro: "chapel_ac_on"
        message: "Setting up Chapel A/C"
      - type: macro
        macro: "chapel_source_logo"
        message: "Setting Chapel source to LOGO"
      - type: notify
        message: "Chapel full setup complete"

  chapel_full_teardown:
    label: "Chapel Teardown"
    icon: "power_settings_new"
    confirm: "Shut down all Chapel AV systems?"
    steps:
      - type: macro
        macro: "chapel_tv_off"
      - type: macro
        macro: "chapel_audio_off"
      - type: macro
        macro: "chapel_ac_off"
      - type: notify
        message: "Chapel fully shut down"

  # ---------------------------------------------------------------------------
  # MAIN CHURCH (examples — expand as needed)
  # ---------------------------------------------------------------------------

  main_video_on:
    label: "Video System On"
    icon: "tv"
    description: "Power on all projectors and lower screens"
    steps:
      - type: epson_all
        state: "on"
        message: "Powering on all projectors"
      - type: notify
        message: "Main church video system turning on"

  main_video_off:
    label: "Video System Off"
    icon: "tv_off"
    confirm: "Turn OFF the entire video system (all projectors + screens)?"
    steps:
      - type: epson_all
        state: "off"
        message: "Powering off all projectors"
      - type: notify
        message: "Main church video system powered off"

  main_audio_on:
    label: "Audio System On"
    icon: "mic"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.wattbox_outlet_1" }
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.wattbox_outlet_2" }

  main_audio_off:
    label: "Audio System Off"
    icon: "mic_off"
    confirm: "Turn OFF the audio system?"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.wattbox_outlet_1" }
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.wattbox_outlet_2" }

  main_proj_only_on:
    label: "Projectors Only On"
    icon: "tv"
    steps:
      - type: epson_all
        state: "on"
        message: "Powering on all projectors"

  main_proj_only_off:
    label: "Projectors Only Off"
    icon: "tv_off"
    confirm: "Turn OFF all projectors?"
    steps:
      - type: epson_all
        state: "off"
        message: "Powering off all projectors"

  main_port_only_on:
    label: "Portables Only On"
    icon: "speaker"
    description: "Turn on portable displays"
    steps:
      # TODO: Replace with actual HA entity for portable displays
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.TODO_main_portables_power" }
        on_fail: skip
        message: "Portables power entity not configured yet"

  main_port_only_off:
    label: "Portables Only Off"
    icon: "speaker"
    confirm: "Turn OFF all portables?"
    steps:
      # TODO: Replace with actual HA entity for portable displays
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.TODO_main_portables_power" }
        on_fail: skip
        message: "Portables power entity not configured yet"

  main_ac_on:
    label: "Main Church A/C On"
    icon: "thermostat"
    steps:
      - type: ha_service
        domain: "climate"
        service: "turn_on"
        data: { entity_id: "climate.mainchurch" }

  main_ac_off:
    label: "Main Church A/C Off"
    icon: "thermostat"
    confirm: "Turn off Main Church A/C?"
    steps:
      - type: ha_service
        domain: "climate"
        service: "turn_off"
        data: { entity_id: "climate.mainchurch" }

  main_appletv_restart:
    label: "Restart AppleTV"
    icon: "restart_alt"
    confirm: "Restart the Main Church AppleTV?"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.sw_022_spare" }
      - type: delay
        seconds: 5
        message: "Waiting for power cycle"
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.sw_022_spare" }
        on_fail: skip

  # --- Main Church video source macros (inline MoIP switches) ---

  main_source_left_podium:
    label: "Left Podium"
    icon: "computer"
    description: "Route Left Podium (TX 22) to all Main Church displays"
    steps:
      - type: moip_switch
        tx: 22
        rx: 47
      - type: moip_switch
        tx: 22
        rx: 34
      - type: moip_switch
        tx: 22
        rx: 36
      - type: moip_switch
        tx: 22
        rx: 37
      - type: moip_switch
        tx: 22
        rx: 38
      - type: moip_switch
        tx: 22
        rx: 39
      - type: moip_switch
        tx: 22
        rx: 22
      - type: moip_switch
        tx: 22
        rx: 10
      - type: moip_switch
        tx: 22
        rx: 19
      - type: moip_switch
        tx: 8
        rx: 26
      - type: moip_switch
        tx: 8
        rx: 35
      - type: moip_switch
        tx: 22
        rx: 32

  main_source_right_podium:
    label: "Right Podium"
    icon: "computer"
    description: "Route Right Podium (TX 23) to all Main Church displays"
    steps:
      - type: moip_switch
        tx: 23
        rx: 34
      - type: moip_switch
        tx: 23
        rx: 36
      - type: moip_switch
        tx: 23
        rx: 37
      - type: moip_switch
        tx: 23
        rx: 38
      - type: moip_switch
        tx: 23
        rx: 39
      - type: moip_switch
        tx: 23
        rx: 22
      - type: moip_switch
        tx: 23
        rx: 10
      - type: moip_switch
        tx: 23
        rx: 19
      - type: moip_switch
        tx: 23
        rx: 47
      - type: moip_switch
        tx: 8
        rx: 26
      - type: moip_switch
        tx: 8
        rx: 35
      - type: moip_switch
        tx: 23
        rx: 32

  main_source_announcements:
    label: "Announcements"
    icon: "announcement"
    description: "Route Announcements (TX 9) to all Main Church displays"
    steps:
      - type: moip_switch
        tx: 9
        rx: 34
      - type: moip_switch
        tx: 9
        rx: 36
      - type: moip_switch
        tx: 9
        rx: 37
      - type: moip_switch
        tx: 9
        rx: 38
      - type: moip_switch
        tx: 9
        rx: 39
      - type: moip_switch
        tx: 9
        rx: 22
      - type: moip_switch
        tx: 9
        rx: 10
      - type: moip_switch
        tx: 9
        rx: 19
      - type: moip_switch
        tx: 9
        rx: 47
      - type: moip_switch
        tx: 9
        rx: 26
      - type: moip_switch
        tx: 9
        rx: 35
      - type: moip_switch
        tx: 9
        rx: 32

  main_source_logo:
    label: "LOGO"
    icon: "image"
    description: "Route LOGO (TX 16) to all Main Church displays"
    steps:
      - type: moip_switch
        tx: 16
        rx: 34
      - type: moip_switch
        tx: 16
        rx: 36
      - type: moip_switch
        tx: 16
        rx: 37
      - type: moip_switch
        tx: 16
        rx: 38
      - type: moip_switch
        tx: 16
        rx: 39
      - type: moip_switch
        tx: 16
        rx: 22
      - type: moip_switch
        tx: 16
        rx: 10
      - type: moip_switch
        tx: 16
        rx: 19
      - type: moip_switch
        tx: 16
        rx: 47
      - type: moip_switch
        tx: 8
        rx: 26
      - type: moip_switch
        tx: 8
        rx: 35
      - type: moip_switch
        tx: 16
        rx: 32

  main_source_livestream:
    label: "Live Stream"
    icon: "live_tv"
    description: "Route Live Stream (TX 8) to Main Church displays"
    steps:
      - type: moip_switch
        tx: 8
        rx: 47
      - type: moip_switch
        tx: 8
        rx: 34
      - type: moip_switch
        tx: 8
        rx: 36
      - type: moip_switch
        tx: 8
        rx: 37
      - type: moip_switch
        tx: 8
        rx: 38
      - type: moip_switch
        tx: 8
        rx: 39
      - type: moip_switch
        tx: 8
        rx: 19
      - type: moip_switch
        tx: 8
        rx: 26
      - type: moip_switch
        tx: 8
        rx: 35

  main_source_appletv_no_pages:
    label: "Apple TV (No Page #s)"
    icon: "cast"
    description: "Route Apple TV (TX 24) directly to all Main Church displays (no page number overlay)"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.sw_022_spare" }
      - type: moip_switch
        tx: 24
        rx: 34
      - type: moip_switch
        tx: 24
        rx: 36
      - type: moip_switch
        tx: 24
        rx: 37
      - type: moip_switch
        tx: 24
        rx: 38
      - type: moip_switch
        tx: 24
        rx: 39
      - type: moip_switch
        tx: 24
        rx: 22
      - type: moip_switch
        tx: 24
        rx: 10
      - type: moip_switch
        tx: 24
        rx: 19
      - type: moip_switch
        tx: 24
        rx: 47
      - type: moip_switch
        tx: 8
        rx: 26
      - type: moip_switch
        tx: 8
        rx: 35
      - type: moip_switch
        tx: 24
        rx: 32
      - type: moip_ir
        receiver: 26
        code: "IRSourceHDMI1"
        message: "Setting Lounge TV to HDMI 1"

  main_source_appletv_pages:
    label: "Apple TV (Page #s)"
    icon: "cast"
    description: "Route Apple TV via ATEM (TX 27) to displays for page number overlay"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.sw_022_spare" }
      - type: moip_switch
        tx: 27
        rx: 47    # Chapel_HDMITransmitter
      - type: moip_switch
        tx: 27
        rx: 34    # MainChurch_PortableTV
      - type: moip_switch
        tx: 27
        rx: 36    # MainChurch_FrontLeft
      - type: moip_switch
        tx: 27
        rx: 37    # MainChurch_FrontRight
      - type: moip_switch
        tx: 27
        rx: 38    # MainChurch_RearRight
      - type: moip_switch
        tx: 27
        rx: 39    # MainChurch_RearLeft
      - type: moip_switch
        tx: 24
        rx: 22    # AV_SlideInput
      - type: moip_switch
        tx: 24
        rx: 10    # AV_SlideInput_SDI
      - type: moip_switch
        tx: 24
        rx: 19    # AV_AnnounceVideoInput
      - type: moip_switch
        tx: 8
        rx: 26    # Lounge (Live Stream)
      - type: moip_switch
        tx: 8
        rx: 35    # MainChurch_CryRoom (Live Stream)
      - type: moip_switch
        tx: 24
        rx: 32    # AV_X32ReceiveToX32
      - type: moip_ir
        receiver: 26
        code: "IRSourceHDMI1"
        message: "Setting Lounge TV to HDMI 1"

  main_source_google_streamer:
    label: "Google Streamer"
    icon: "cast_connected"
    description: "Route Google Streamer (TX 25) to all Main Church displays"
    steps:
      - type: moip_switch
        tx: 25
        rx: 34
      - type: moip_switch
        tx: 25
        rx: 36
      - type: moip_switch
        tx: 25
        rx: 37
      - type: moip_switch
        tx: 25
        rx: 38
      - type: moip_switch
        tx: 25
        rx: 39
      - type: moip_switch
        tx: 25
        rx: 22
      - type: moip_switch
        tx: 25
        rx: 10
      - type: moip_switch
        tx: 25
        rx: 19
      - type: moip_switch
        tx: 25
        rx: 47
      - type: moip_switch
        tx: 8
        rx: 26
      - type: moip_switch
        tx: 8
        rx: 35
      - type: moip_switch
        tx: 25
        rx: 32

  # --- Main Church individual projector macros ---

  main_epson1_on:
    label: "PRJ Front Left ON"
    icon: "tv"
    steps:
      - type: epson_power
        projector: "epson1"
        state: "on"

  main_epson1_off:
    label: "PRJ Front Left OFF"
    icon: "tv_off"
    steps:
      - type: epson_power
        projector: "epson1"
        state: "off"

  main_epson2_on:
    label: "PRJ Front Right ON"
    icon: "tv"
    steps:
      - type: epson_power
        projector: "epson2"
        state: "on"

  main_epson2_off:
    label: "PRJ Front Right OFF"
    icon: "tv_off"
    steps:
      - type: epson_power
        projector: "epson2"
        state: "off"

  main_epson3_on:
    label: "PRJ Rear Left ON"
    icon: "tv"
    steps:
      - type: epson_power
        projector: "epson3"
        state: "on"

  main_epson3_off:
    label: "PRJ Rear Left OFF"
    icon: "tv_off"
    steps:
      - type: epson_power
        projector: "epson3"
        state: "off"

  main_epson4_on:
    label: "PRJ Rear Right ON"
    icon: "tv"
    steps:
      - type: epson_power
        projector: "epson4"
        state: "on"

  main_epson4_off:
    label: "PRJ Rear Right OFF"
    icon: "tv_off"
    steps:
      - type: epson_power
        projector: "epson4"
        state: "off"

  # --- Main Church WattBox macros ---

  main_wattbox1_on:
    label: "WattBox 1 ON"
    icon: "power"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.wattbox_outlet_1" }

  main_wattbox1_off:
    label: "WattBox 1 OFF"
    icon: "power_off"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.wattbox_outlet_1" }

  main_wattbox2_on:
    label: "WattBox 2 ON"
    icon: "power"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.wattbox_outlet_2" }

  main_wattbox2_off:
    label: "WattBox 2 OFF"
    icon: "power_off"
    steps:
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.wattbox_outlet_2" }

  # --- Main Church baptism camera ---

  main_baptism_camera:
    label: "Baptism Camera View"
    icon: "videocam"
    description: "Route Baptism Room camera to Main Church displays"
    steps:
      - type: moip_switch
        tx: 21
        rx: 47
      - type: moip_switch
        tx: 21
        rx: 34

  # ---------------------------------------------------------------------------
  # SOCIAL HALL
  # ---------------------------------------------------------------------------

  social_video_on:
    label: "Social Hall Video On"
    icon: "tv"
    steps:
      # TODO: Replace with actual HA entity for Social Hall video/TV power
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.TODO_social_video_power" }
        on_fail: skip
        message: "Social Hall video entity not configured yet"

  social_video_off:
    label: "Social Hall Video Off"
    icon: "tv_off"
    confirm: "Turn off Social Hall video?"
    steps:
      # TODO: Replace with actual HA entity for Social Hall video/TV power
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.TODO_social_video_power" }
        on_fail: skip
        message: "Social Hall video entity not configured yet"

  social_audio_on:
    label: "Social Hall Audio On"
    icon: "mic"
    steps:
      # TODO: Replace with actual HA entity for Social Hall audio power
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.TODO_social_audio_power" }
        on_fail: skip
        message: "Social Hall audio entity not configured yet"

  social_audio_off:
    label: "Social Hall Audio Off"
    icon: "mic_off"
    confirm: "Turn off Social Hall audio?"
    steps:
      # TODO: Replace with actual HA entity for Social Hall audio power
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.TODO_social_audio_power" }
        on_fail: skip
        message: "Social Hall audio entity not configured yet"

  social_ac_on:
    label: "Social Hall A/C On"
    icon: "thermostat"
    steps:
      - type: ha_service
        domain: "climate"
        service: "turn_on"
        data: { entity_id: "climate.social_hall_new" }

  social_ac_off:
    label: "Social Hall A/C Off"
    icon: "thermostat"
    confirm: "Turn off Social Hall A/C?"
    steps:
      - type: ha_service
        domain: "climate"
        service: "turn_off"
        data: { entity_id: "climate.social_hall_new" }

  social_source_appletv:
    label: "Social Hall Apple TV"
    icon: "cast"
    steps:
      - type: moip_switch
        tx: 6
        rx: 7
      - type: moip_switch
        tx: 6
        rx: 8

  social_source_livestream:
    label: "Social Hall Live Stream"
    icon: "live_tv"
    steps:
      - type: moip_switch
        tx: 8
        rx: 7
      - type: moip_switch
        tx: 8
        rx: 8

  social_source_logo:
    label: "Social Hall LOGO"
    icon: "image"
    steps:
      - type: moip_switch
        tx: 16
        rx: 7
      - type: moip_switch
        tx: 16
        rx: 8

  social_source_announcements:
    label: "Social Hall Announcements"
    icon: "announcement"
    steps:
      - type: moip_switch
        tx: 9
        rx: 7
      - type: moip_switch
        tx: 9
        rx: 8

  social_source_camera:
    label: "Social Hall Camera"
    icon: "videocam"
    steps:
      - type: moip_switch
        tx: 2
        rx: 7
      - type: moip_switch
        tx: 2
        rx: 8

  # ---------------------------------------------------------------------------
  # GYM
  # ---------------------------------------------------------------------------

  gym_video_on:
    label: "Gym Video On"
    icon: "tv"
    steps:
      # TODO: Replace with actual HA entity for Gym video/TV power
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.TODO_gym_video_power" }
        on_fail: skip
        message: "Gym video entity not configured yet"

  gym_video_off:
    label: "Gym Video Off"
    icon: "tv_off"
    confirm: "Turn off Gym video?"
    steps:
      # TODO: Replace with actual HA entity for Gym video/TV power
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.TODO_gym_video_power" }
        on_fail: skip
        message: "Gym video entity not configured yet"

  gym_audio_on:
    label: "Gym Audio On"
    icon: "mic"
    steps:
      # TODO: Replace with actual HA entity for Gym audio power
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.TODO_gym_audio_power" }
        on_fail: skip
        message: "Gym audio entity not configured yet"

  gym_audio_off:
    label: "Gym Audio Off"
    icon: "mic_off"
    confirm: "Turn off Gym audio?"
    steps:
      # TODO: Replace with actual HA entity for Gym audio power
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.TODO_gym_audio_power" }
        on_fail: skip
        message: "Gym audio entity not configured yet"

  gym_source_livestream:
    label: "Gym Live Stream"
    icon: "live_tv"
    steps:
      - type: moip_switch
        tx: 8
        rx: 9
      - type: moip_switch
        tx: 8
        rx: 27

  gym_source_logo:
    label: "Gym LOGO"
    icon: "image"
    steps:
      - type: moip_switch
        tx: 16
        rx: 9
      - type: moip_switch
        tx: 16
        rx: 27

  gym_source_announcements:
    label: "Gym Announcements"
    icon: "announcement"
    steps:
      - type: moip_switch
        tx: 9
        rx: 9
      - type: moip_switch
        tx: 9
        rx: 27

  # ---------------------------------------------------------------------------
  # CONFERENCE ROOM (Two independent TVs: Left=RX28, Right=RX29)
  # ---------------------------------------------------------------------------

  # --- Left TV (RX 28 = ConfRoom_Left) ---

  confroom_left_tv_on:
    label: "Left TV On"
    icon: "tv"
    steps:
      - type: moip_ir
        receiver: 28
        code: "IRPowerOn"
        message: "Sending power-on to Conference Room Left TV"
      - type: delay
        seconds: 5
        message: "Waiting for TV to initialize"
      - type: moip_ir
        receiver: 28
        code: "IRSourceHDMI1"
        message: "Setting Left TV to HDMI 1"

  confroom_left_tv_off:
    label: "Left TV Off"
    icon: "tv_off"
    confirm: "Turn off Conference Room Left TV?"
    steps:
      - type: moip_ir
        receiver: 28
        code: "IRPowerOff"
        message: "Powering off Conference Room Left TV"

  confroom_left_source_laptop:
    label: "Left TV Laptop"
    icon: "computer"
    steps:
      - type: moip_switch
        tx: 5
        rx: 28

  confroom_left_source_livestream:
    label: "Left TV Live Stream"
    icon: "live_tv"
    steps:
      - type: moip_switch
        tx: 8
        rx: 28

  confroom_left_source_logo:
    label: "Left TV LOGO"
    icon: "image"
    steps:
      - type: moip_switch
        tx: 16
        rx: 28

  confroom_left_source_announcements:
    label: "Left TV Announcements"
    icon: "announcement"
    steps:
      - type: moip_switch
        tx: 9
        rx: 28

  # --- Right TV (RX 29 = ConfRoom_Right) ---

  confroom_right_tv_on:
    label: "Right TV On"
    icon: "tv"
    steps:
      - type: moip_ir
        receiver: 29
        code: "IRPowerOn"
        message: "Sending power-on to Conference Room Right TV"
      - type: delay
        seconds: 5
        message: "Waiting for TV to initialize"
      - type: moip_ir
        receiver: 29
        code: "IRSourceHDMI1"
        message: "Setting Right TV to HDMI 1"

  confroom_right_tv_off:
    label: "Right TV Off"
    icon: "tv_off"
    confirm: "Turn off Conference Room Right TV?"
    steps:
      - type: moip_ir
        receiver: 29
        code: "IRPowerOff"
        message: "Powering off Conference Room Right TV"

  confroom_right_source_laptop:
    label: "Right TV Laptop"
    icon: "computer"
    steps:
      - type: moip_switch
        tx: 5
        rx: 29

  confroom_right_source_livestream:
    label: "Right TV Live Stream"
    icon: "live_tv"
    steps:
      - type: moip_switch
        tx: 8
        rx: 29

  confroom_right_source_logo:
    label: "Right TV LOGO"
    icon: "image"
    steps:
      - type: moip_switch
        tx: 16
        rx: 29

  confroom_right_source_announcements:
    label: "Right TV Announcements"
    icon: "announcement"
    steps:
      - type: moip_switch
        tx: 9
        rx: 29

  # --- Video Conference System ---

  confroom_vidconf_on:
    label: "Video Conference On"
    icon: "video_call"
    steps:
      # TODO: Replace with actual HA entity for video conference system power
      - type: ha_service
        domain: "switch"
        service: "turn_on"
        data: { entity_id: "switch.TODO_confroom_vidconf_power" }
        on_fail: skip
        message: "Video conference power entity not configured yet"

  confroom_vidconf_off:
    label: "Video Conference Off"
    icon: "call_end"
    confirm: "Turn off Video Conference system?"
    steps:
      # TODO: Replace with actual HA entity for video conference system power
      - type: ha_service
        domain: "switch"
        service: "turn_off"
        data: { entity_id: "switch.TODO_confroom_vidconf_power" }
        on_fail: skip
        message: "Video conference power entity not configured yet"


# =============================================================================
# BUTTON LAYOUT
# =============================================================================
# Defines which buttons appear on each page. Each button has:
#   label    — Display text (default label; overridden by toggle on/off labels)
#   icon     — Material Icons name
#   action   — What happens when pressed:
#                { type: macro, macro: "key" }       Run a macro
#                { type: moip_switch, tx: N, rx: N } Direct single switch
#                { type: navigate, page: "name" }    Navigate to a page
#                { type: ha_service, domain, service, data }  Direct HA call
#   style    — Visual style: "default", "danger", "large", "success"
#              (can combine: "large danger")
#   span     — Grid column span (default 1)
#   confirm  — Optional confirmation message (overrides macro-level confirm)
#   confirm_steps — Show expanded step list as checkboxes before executing
#   state    — Optional live state binding:
#                source   — "ha", "obs", "x32", "moip", "projectors"
#                entity   — HA entity_id (for ha source)
#                field    — Dot-path into cached state (for other sources)
#                on_value — Value that means "active"
#                off_value — Value that means "inactive" (alternative to on_value)
#                on_style — CSS class when active: "active", "live", "recording"
#
#     STATE BINDING EXAMPLES BY SOURCE:
#
#     "ha" — Home Assistant entity state
#       state:
#         source: ha
#         entity: "switch.chapel_audio_power"
#         on_value: "on"                         # active when entity state == "on"
#         on_style: "active"
#
#     "ha" — Climate (active when NOT off)
#       state:
#         source: ha
#         entity: "climate.mainchurch"
#         off_value: "off"                       # active when state != "off"
#         on_style: "active"
#
#     "obs" — OBS streaming/recording state
#       state:
#         source: obs
#         field: "streaming"                     # dot-path into OBS state cache
#         on_value: "true"
#         on_style: "live"
#
#     "x32" — Behringer X32 mixer state
#       state:
#         source: x32
#         field: "channels.ch01.mute"            # dot-path into X32 state cache
#         on_value: "0"                          # 0 = unmuted (active), 1 = muted
#         on_style: "active"
#
#     "moip" — MoIP video matrix (which TX is routed to an RX)
#       state:
#         source: moip
#         field: "47.transmitter_id"             # RX 47's current transmitter
#         on_value: "14"                         # active when TX 14 is routed to RX 47
#         on_style: "active"
#       (The field is "<receiver_id>.transmitter_id" — check devices.json for IDs)
#
#     "projectors" — Epson projector power state
#       state:
#         source: projectors
#         field: "epson1.power"                  # dot-path into projector cache
#         on_value: "on"
#         on_style: "active"
#   collapsed — If true, section starts collapsed (click title to expand)
#
# NEW FEATURES:
#   toggle   — Single button that swaps appearance + action based on state:
#                state    — State binding (same format as above, with on_style)
#                on       — { label, icon, style, action, confirm, confirm_steps }
#                off      — { label, icon, style, action }
#   badge    — Small overlay pill showing a live value:
#                source, entity, field, attribute — where to read the value
#                format   — "temp" (°F), "percent" (%), "duration", or "text"
#   disabled_when — Gray out button/section when a condition is met:
#                source, entity, field, attribute — where to read the value
#                value    — the value that means "disabled"
#              Can be set at section level (applies to all items) or button level.
#   long_press — Alternative action on ~800ms hold:
#                action   — same format as button action
# =============================================================================

buttons:

  chapel:
    - section: "System"
      items:
        - label: "Full Setup"
          icon: "play_circle"
          action: { type: macro, macro: chapel_full_setup }
          style: "large success"
          span: 2
          confirm_steps: true
        - label: "Full Teardown"
          icon: "power_settings_new"
          action: { type: macro, macro: chapel_full_teardown }
          style: "large danger"
          span: 2
          confirm_steps: true

    - section: "Video"
      cols: 4
      items:
        - label: "TVs On"
          icon: "tv"
          action: { type: macro, macro: chapel_tv_on }
          state:
            source: ha
            entity: "switch.bat_chapeltv_1_ac_enabled"
            on_value: "on"
            on_style: "active"
          badge:
            source: ha
            entity: "sensor.bat_chapeltv_1_battery_level"
            format: "percent"
        - label: "TVs Off"
          icon: "tv_off"
          action: { type: macro, macro: chapel_tv_off }
          style: "danger"
          confirm: "Turn off all Chapel TVs?"

    - section: "Audio"
      cols: 4
      items:
        - label: "Audio On"
          icon: "mic"
          action: { type: macro, macro: chapel_audio_on }
          state:
            source: ha
            entity: "switch.chapel_audio_power"
            on_value: "on"
            on_style: "active"
        - label: "Audio Off"
          icon: "mic_off"
          action: { type: macro, macro: chapel_audio_off }
          style: "danger"

    - section: "A/C"
      cols: 4
      items:
        - label: "Thermostat"
          icon: "thermostat"
          action: { type: thermostat, entity: "climate.chapel_and_main_hallway" }
          state:
            source: ha
            entity: "climate.chapel_and_main_hallway"
            off_value: "off"
            on_style: "active"
          badge:
            source: ha
            entity: "climate.chapel_and_main_hallway"
            attribute: "current_temperature"
            format: "temp"

    - section: "Video Sources"
      disabled_when:
        source: ha
        entity: "switch.bat_chapeltv_1_ac_enabled"
        value: "off"
      items:
        - label: "Apple TV"
          icon: "cast"
          action: { type: macro, macro: chapel_source_appletv }
          state:
            source: moip
            field: "47.transmitter_id"
            on_value: "14"
            on_style: "active"
        - label: "Live Stream"
          icon: "live_tv"
          action: { type: macro, macro: chapel_source_livestream }
          state:
            source: moip
            field: "47.transmitter_id"
            on_value: "8"
            on_style: "active"
        - label: "LOGO"
          icon: "image"
          action: { type: macro, macro: chapel_source_logo }
          state:
            source: moip
            field: "47.transmitter_id"
            on_value: "16"
            on_style: "active"
        - label: "Announcements"
          icon: "announcement"
          action: { type: macro, macro: chapel_source_announcements }
          state:
            source: moip
            field: "47.transmitter_id"
            on_value: "9"
            on_style: "active"

  main:
    - section: "Video"
      cols: 4
      items:
        - label: "On / Down"
          icon: "tv"
          action: { type: macro, macro: main_video_on }
          style: "large"
        - label: "Off / Up"
          icon: "tv_off"
          action: { type: macro, macro: main_video_off }
          style: "large danger"
          confirm: "Turn OFF the entire video system (all projectors + screens)?"
        - label: "Projectors Only On"
          icon: "tv"
          action: { type: macro, macro: main_proj_only_on }
        - label: "Projectors Only Off"
          icon: "tv_off"
          action: { type: macro, macro: main_proj_only_off }
          style: "danger"
        - label: "Portables Only On"
          icon: "speaker"
          action: { type: macro, macro: main_port_only_on }
        - label: "Portables Only Off"
          icon: "speaker"
          action: { type: macro, macro: main_port_only_off }
          style: "danger"

    - section: "Audio System"
      cols: 4
      items:
        - label: "On"
          icon: "mic"
          action: { type: macro, macro: main_audio_on }
          style: "large"
          state:
            source: ha
            entity: "switch.wattbox_outlet_1"
            on_value: "on"
            on_style: "active"
        - label: "Off"
          icon: "mic_off"
          action: { type: macro, macro: main_audio_off }
          style: "large danger"
        - label: "AppleTV Restart"
          icon: "restart_alt"
          action: { type: macro, macro: main_appletv_restart }

    - section: "A/C"
      cols: 4
      items:
        - label: "Thermostat"
          icon: "thermostat"
          action: { type: thermostat, entity: "climate.mainchurch" }
          style: "large"
          state:
            source: ha
            entity: "climate.mainchurch"
            off_value: "off"
            on_style: "active"
          badge:
            source: ha
            entity: "climate.mainchurch"
            attribute: "current_temperature"
            format: "temp"

    - section: "People Counts"
      cols: 4
      items:
        - label: "Occupancy"
          icon: "groups"
          action: { type: camlytics_panel }
          badge:
            source: camlytics
            field: "occupancy_adjusted"
        - label: "Communion"
          icon: "how_to_reg"
          action: { type: camlytics_panel }
          badge:
            source: camlytics
            field: "communion_adjusted"

    - section: "For Advanced People Count Settings, click here"
      display: "link"
      cols: 4
      items:
        - label: "Peak Bldg Occupancy"
          icon: "groups"
          action: { type: camlytics_panel }
          badge:
            source: camlytics
            field: "occupancy_adjusted"
        - label: "Communion Count"
          icon: "how_to_reg"
          action: { type: camlytics_panel }
          badge:
            source: camlytics
            field: "communion_adjusted"
        - label: "Building Entry Count"
          icon: "sensor_door"
          action: { type: camlytics_panel }
          badge:
            source: camlytics
            field: "enter_adjusted"
        - label: "Live Occupancy"
          icon: "person"
          action: { type: camlytics_panel }
          badge:
            source: camlytics
            field: "occupancy_live"

    - section: "Video Sources"
      items:
        - label: "Left Podium"
          icon: "computer"
          action: { type: macro, macro: main_source_left_podium }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "22"
            on_style: "active"
        - label: "Right Podium"
          icon: "computer"
          action: { type: macro, macro: main_source_right_podium }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "23"
            on_style: "active"
        - label: "Announcements"
          icon: "announcement"
          action: { type: macro, macro: main_source_announcements }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "9"
            on_style: "active"
        - label: "LOGO"
          icon: "image"
          action: { type: macro, macro: main_source_logo }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "16"
            on_style: "active"
        - label: "Live Stream"
          icon: "live_tv"
          action: { type: macro, macro: main_source_livestream }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "8"
            on_style: "active"
        - label: "Apple TV (No Page #s)"
          icon: "cast"
          action: { type: macro, macro: main_source_appletv_no_pages }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "24"
            on_style: "active"
        - label: "Apple TV (Page #s)"
          icon: "cast"
          action: { type: macro, macro: main_source_appletv_pages }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "27"
            on_style: "active"
        - label: "Google Streamer"
          icon: "cast_connected"
          action: { type: macro, macro: main_source_google_streamer }
          state:
            source: moip
            field: "36.transmitter_id"
            on_value: "25"
            on_style: "active"

    - section: "Advanced Display Settings"
      display: "link"
      cols: 4
      items:
        - label: "PRJ Front Left"
          icon: "tv"
          toggle:
            state:
              source: projectors
              field: "epson1.power"
              on_value: "on"
              on_style: "active"
            on:
              label: "PRJ Front Left On"
              icon: "tv"
              action: { type: macro, macro: main_epson1_off }
            off:
              label: "PRJ Front Left Off"
              icon: "tv_off"
              action: { type: macro, macro: main_epson1_on }
        - label: "PRJ Front Right"
          icon: "tv"
          toggle:
            state:
              source: projectors
              field: "epson2.power"
              on_value: "on"
              on_style: "active"
            on:
              label: "PRJ Front Right On"
              icon: "tv"
              action: { type: macro, macro: main_epson2_off }
            off:
              label: "PRJ Front Right Off"
              icon: "tv_off"
              action: { type: macro, macro: main_epson2_on }
        - label: "PRJ Rear Left"
          icon: "tv"
          toggle:
            state:
              source: projectors
              field: "epson3.power"
              on_value: "on"
              on_style: "active"
            on:
              label: "PRJ Rear Left On"
              icon: "tv"
              action: { type: macro, macro: main_epson3_off }
            off:
              label: "PRJ Rear Left Off"
              icon: "tv_off"
              action: { type: macro, macro: main_epson3_on }
        - label: "PRJ Rear Right"
          icon: "tv"
          toggle:
            state:
              source: projectors
              field: "epson4.power"
              on_value: "on"
              on_style: "active"
            on:
              label: "PRJ Rear Right On"
              icon: "tv"
              action: { type: macro, macro: main_epson4_off }
            off:
              label: "PRJ Rear Right Off"
              icon: "tv_off"
              action: { type: macro, macro: main_epson4_on }

    - section: "Advanced Power Settings"
      display: "link"
      cols: 4
      items:
        - label: "WattBox 1"
          icon: "power"
          toggle:
            state:
              source: ha
              entity: "switch.wattbox_outlet_1"
              on_value: "on"
              on_style: "active"
            on:
              label: "WattBox 1 On"
              icon: "power"
              action: { type: macro, macro: main_wattbox1_off }
            off:
              label: "WattBox 1 Off"
              icon: "power_off"
              action: { type: macro, macro: main_wattbox1_on }
        - label: "WattBox 2"
          icon: "power"
          toggle:
            state:
              source: ha
              entity: "switch.wattbox_outlet_2"
              on_value: "on"
              on_style: "active"
            on:
              label: "WattBox 2 On"
              icon: "power"
              action: { type: macro, macro: main_wattbox2_off }
            off:
              label: "WattBox 2 Off"
              icon: "power_off"
              action: { type: macro, macro: main_wattbox2_on }

    - section: "Baptism / Wedding"
      display: "link"
      cols: 4
      items:
        - label: "Baptism Camera View"
          icon: "videocam"
          action: { type: macro, macro: main_baptism_camera }

  social:
    - section: "Video"
      cols: 4
      items:
        - label: "On"
          icon: "tv"
          action: { type: macro, macro: social_video_on }
          style: "large"
        - label: "Off"
          icon: "tv_off"
          action: { type: macro, macro: social_video_off }
          style: "large danger"

    - section: "Audio System"
      cols: 4
      items:
        - label: "On"
          icon: "mic"
          action: { type: macro, macro: social_audio_on }
          style: "large"
        - label: "Off"
          icon: "mic_off"
          action: { type: macro, macro: social_audio_off }
          style: "large danger"

    - section: "A/C"
      cols: 4
      items:
        - label: "Thermostat"
          icon: "thermostat"
          action: { type: thermostat, entity: "climate.social_hall_new" }
          style: "large"
          state:
            source: ha
            entity: "climate.social_hall_new"
            off_value: "off"
            on_style: "active"
          badge:
            source: ha
            entity: "climate.social_hall_new"
            attribute: "current_temperature"
            format: "temp"

    - section: "Video Sources"
      items:
        - label: "Apple TV"
          icon: "cast"
          action: { type: macro, macro: social_source_appletv }
          state:
            source: moip
            field: "11.transmitter_id"
            on_value: "6"
            on_style: "active"
        - label: "Live Stream"
          icon: "live_tv"
          action: { type: macro, macro: social_source_livestream }
          state:
            source: moip
            field: "11.transmitter_id"
            on_value: "8"
            on_style: "active"
        - label: "LOGO"
          icon: "image"
          action: { type: macro, macro: social_source_logo }
          state:
            source: moip
            field: "11.transmitter_id"
            on_value: "16"
            on_style: "active"
        - label: "Announcements"
          icon: "announcement"
          action: { type: macro, macro: social_source_announcements }
          state:
            source: moip
            field: "11.transmitter_id"
            on_value: "9"
            on_style: "active"
        - label: "Camera"
          icon: "videocam"
          action: { type: macro, macro: social_source_camera }
          state:
            source: moip
            field: "11.transmitter_id"
            on_value: "2"
            on_style: "active"

  gym:
    - section: "Video"
      cols: 4
      items:
        - label: "On"
          icon: "tv"
          action: { type: macro, macro: gym_video_on }
          style: "large"
        - label: "Off"
          icon: "tv_off"
          action: { type: macro, macro: gym_video_off }
          style: "large danger"

    - section: "Audio"
      cols: 4
      items:
        - label: "On"
          icon: "mic"
          action: { type: macro, macro: gym_audio_on }
          style: "large"
        - label: "Off"
          icon: "mic_off"
          action: { type: macro, macro: gym_audio_off }
          style: "large danger"

    - section: "Video Sources"
      items:
        - label: "Live Stream"
          icon: "live_tv"
          action: { type: macro, macro: gym_source_livestream }
          state:
            source: moip
            field: "9.transmitter_id"
            on_value: "8"
            on_style: "active"
        - label: "LOGO"
          icon: "image"
          action: { type: macro, macro: gym_source_logo }
          state:
            source: moip
            field: "9.transmitter_id"
            on_value: "16"
            on_style: "active"
        - label: "Announcements"
          icon: "announcement"
          action: { type: macro, macro: gym_source_announcements }
          state:
            source: moip
            field: "9.transmitter_id"
            on_value: "9"
            on_style: "active"

  confroom:
    - section: "Left TV"
      cols: 4
      items:
        - label: "On"
          icon: "tv"
          action: { type: macro, macro: confroom_left_tv_on }
          style: "large"
        - label: "Off"
          icon: "tv_off"
          action: { type: macro, macro: confroom_left_tv_off }
          style: "large danger"

    - section: "Right TV"
      cols: 4
      items:
        - label: "On"
          icon: "tv"
          action: { type: macro, macro: confroom_right_tv_on }
          style: "large"
        - label: "Off"
          icon: "tv_off"
          action: { type: macro, macro: confroom_right_tv_off }
          style: "large danger"

    - section: "Video Conference"
      cols: 4
      items:
        - label: "On"
          icon: "video_call"
          action: { type: macro, macro: confroom_vidconf_on }
          style: "large"
        - label: "Off"
          icon: "call_end"
          action: { type: macro, macro: confroom_vidconf_off }
          style: "large danger"

    - section: "A/C"
      cols: 4
      items:
        - label: "Thermostat"
          icon: "thermostat"
          action: { type: thermostat, entity: "climate.sunday_school" }
          style: "large"
          state:
            source: ha
            entity: "climate.sunday_school"
            off_value: "off"
            on_style: "active"
          badge:
            source: ha
            entity: "climate.sunday_school"
            attribute: "current_temperature"
            format: "temp"

    - section: "Left TV Sources"
      items:
        - label: "Laptop"
          icon: "computer"
          action: { type: macro, macro: confroom_left_source_laptop }
          state:
            source: moip
            field: "28.transmitter_id"
            on_value: "5"
            on_style: "active"
        - label: "Live Stream"
          icon: "live_tv"
          action: { type: macro, macro: confroom_left_source_livestream }
          state:
            source: moip
            field: "28.transmitter_id"
            on_value: "8"
            on_style: "active"
        - label: "LOGO"
          icon: "image"
          action: { type: macro, macro: confroom_left_source_logo }
          state:
            source: moip
            field: "28.transmitter_id"
            on_value: "16"
            on_style: "active"
        - label: "Announcements"
          icon: "announcement"
          action: { type: macro, macro: confroom_left_source_announcements }
          state:
            source: moip
            field: "28.transmitter_id"
            on_value: "9"
            on_style: "active"

    - section: "Right TV Sources"
      items:
        - label: "Laptop"
          icon: "computer"
          action: { type: macro, macro: confroom_right_source_laptop }
          state:
            source: moip
            field: "29.transmitter_id"
            on_value: "5"
            on_style: "active"
        - label: "Live Stream"
          icon: "live_tv"
          action: { type: macro, macro: confroom_right_source_livestream }
          state:
            source: moip
            field: "29.transmitter_id"
            on_value: "8"
            on_style: "active"
        - label: "LOGO"
          icon: "image"
          action: { type: macro, macro: confroom_right_source_logo }
          state:
            source: moip
            field: "29.transmitter_id"
            on_value: "16"
            on_style: "active"
        - label: "Announcements"
          icon: "announcement"
          action: { type: macro, macro: confroom_right_source_announcements }
          state:
            source: moip
            field: "29.transmitter_id"
            on_value: "9"
            on_style: "active"
